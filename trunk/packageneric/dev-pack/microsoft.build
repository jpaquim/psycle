#! /bin/bash

####### TODO: update to newer versions #######

set -o nounset &&

function main
{
	cd $(dirname $0) &&
	rm --recursive --force unpack &&
	download-binutils &&
	download-gcc &&
	download-autotools &&
	download-w
} &&

function download
{
	local tarball=$1 && shift &&
	mkdir --parents download &&
	(cd download && wget --continue $tarball) &&
	tarball=$(basename $tarball) &&
	case $tarball in
		*.txt) : ;;
		*) unpack download/$tarball ;;
	esac
} &&

function unpack
{
	local tarball=$1 && shift &&
	case $tarball in
		*.tar.bz2)        local decompress="bzip2 --decompress" ;;
		*.tar.gz | *.tgz) local decompress="gzip  --decompress" ;;
		*) echo unknown file extension: $tarball && false ; return ;;
	esac &&
	mkdir --parents unpack &&
	(cd unpack && $decompress | tar --extract) < $tarball
	echo $(basename $tarball) >> unpack/VERSIONS
} &&

function download-sourceforge
{
	download http://ovh.dl.sourceforge.net/sourceforge/$1
} &&

function download-gtk
{
	download ftp://ftp.gtk.org/pub/gtk/$1
} &&

function download-mingw
{
	download-sourceforge mingw/$1
} &&

function download-binutils
{
	download-mingw binutils-2.16.91-20050827-1-notes.txt &&
	download-mingw binutils-2.16.91-20050827-1.tar.gz
} &&

function download-gcc
{
	download-mingw gcc-3.4.5-release_notes.txt &&
	download-mingw gcc-core-3.4.5-20051220-1.tar.gz &&
	download-mingw gcc-g++-3.4.5-20051220-1.tar.gz
} &&

function download-w
{
	download-mingw w32api-3.5.tar.gz &&
	download-mingw mingw-runtime-3.9.tar.gz &&
	download-mingw mingw-utils-0.3.tar.gz
} &&

function download-autotools
{
	download-mingw msys-autoconf-2.59.tar.bz2 &&
	download-mingw msys-automake-1.8.2.tar.bz2 &&
	download-mingw msys-libtool-1.5.tar.bz2
} &&

main "$@"
