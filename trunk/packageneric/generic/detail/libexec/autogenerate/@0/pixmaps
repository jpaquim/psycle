#! /bin/bash

##############################################################################
#
# This source is free software ; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation ; either version 2, or (at your option) any later version.
# Copyright (C) 1999-2005 Psycledelics http://psycle.pastnotecut.org : Johan Boule
#
# autotools autogenerator plugin
# \meta generic
# \meta standard gnu
#
##############################################################################

set -eu &&

function main
{
	local output=$PACKAGENERIC__OUTPUT/autotools/automake/$PACKAGENERIC__SUBPATH &&
	mkdir --parents $output &&
	{
		cat > $output/SUBDIRS.am <<-eof
			#! /usr/bin/automake
			# This file was autogenerated by $PACKAGENERIC__SUBPATH ; do not edit.
		eof
	} &&
	if test -e $(basename $PACKAGENERIC__SUBPATH)
	then
		cd $(basename $PACKAGENERIC__SUBPATH) &&
		echo SUBDIRS += $(basename $PACKAGENERIC__SUBPATH) >> $output/SUBDIRS.am
		output=$output.am
		{
			cat > $output <<-eof
				pkg$(basename $PACKAGENERIC__SUBPATH)dir = \$(datadir)/$(basename $PACKAGENERIC__SUBPATH)/\$(PACKAGENERIC__PACKAGE__NAME)
				nobase_dist_pkg$(basename $PACKAGENERIC__SUBPATH)_DATA =
			eof
		} &&
		for file in $(eval find . $(packageneric__find__file \\\( -name \\\*.svg -or -name \\\*.png -or -name \\\*.xpm -or -name \\\*.jpeg -or -name \\\*.gif \\\)))
		do
			echo nobase_dist_pkg$(basename $PACKAGENERIC__SUBPATH)_DATA += $file >> $output ||
			return
		done
	fi
} &&

main "$@"
