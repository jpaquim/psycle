#! /bin/bash

##############################################################################
#
# This source is free software ; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation ; either version 2, or (at your option) any later version.
# Copyright (C) 1999-2005 Psycledelics http://psycle.pastnotecut.org : Johan Boule
#
# autotools autogenerator plugin
# \meta generic
# \meta standard gnu
#
##############################################################################

set -eu &&

function main
{
	local output__ac=$PACKAGENERIC__OUTPUT/autotools/autoconf/$PACKAGENERIC__SUBPATH/CONFIG_SUBDIRS.ac &&
	local output__am=$PACKAGENERIC__OUTPUT/autotools/automake/$PACKAGENERIC__SUBPATH/SUBDIRS.am &&
	mkdir --parents $(dirname $output__ac) $(dirname $output__am) &&
	{
		cat > $output__ac <<-eof
			#! /usr/bin/autoconf
			# This file was autogenerated by $PACKAGENERIC__SUBPATH ; do not edit.
		eof
	} &&
	{
		cat > $output__am <<-eof
			#! /usr/bin/automake
			# This file was autogenerated by $PACKAGENERIC__SUBPATH ; do not edit.
		eof
	} &&
	local nested=packageneric/$PACKAGENERIC__SUBPATH &&
	if test -d $nested
	then
		echo if PACKAGENERIC__CONFIGURATION__OPTION__WITH\(nested_source_packages\) >> $output__ac &&
		echo then >> $output__ac &&
		for dir in $(eval find $nested -maxdepth 1 $(packageneric__find__dir__no_arch))
		do
			if test -e $dir/configure.ac -o -e $dir/configure
			then
				echo -e \\tAC_CONFIG_SUBDIRS\($dir\) >> $output__ac
			fi &&
			if test -e $dir/Makefile.am -o -e $dir/Makefile.in -o -e $dir/Makefile
			then
				cat > $output__am <<-eof
					DISTSUBDIRS += $nested/$(basename $dir)
					if PACKAGENERIC__CONFIGURATION__OPTION__WITH__NESTED_SOURCE_PACKAGES
					SUBDIRS += $nested/$(basename $dir)
					endif
				eof
			fi ||
			return
		done &&
		echo fi >> $output__ac
	fi
} &&

main "$@"
